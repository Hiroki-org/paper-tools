exports.id=730,exports.ids=[730],exports.modules={91:()=>{},3139:()=>{},4286:(a,b,c)=>{"use strict";c.d(b,{cU:()=>k,C3:()=>g,s3:()=>i,Bu:()=>o,b$:()=>n,wG:()=>m});var d=c(8885);let e={タイトル:{type:"title",required:!0},DOI:{type:"rich_text",required:!0},著者:{type:"rich_text",required:!1},年:{type:"number",required:!1},"会議/ジャーナル":{type:"rich_text",required:!1},被引用数:{type:"number",required:!1},分野:{type:"multi_select",required:!1},ソース:{type:"select",required:!1},"Open Access PDF":{type:"url",required:!1},"Semantic Scholar ID":{type:"rich_text",required:!1},要約:{type:"rich_text",required:!1}};function f(){let a=process.env.NOTION_API_KEY;if(!a)throw Error("NOTION_API_KEY が未設定です");return new d.Kj({auth:a})}async function g(a,b=f()){let c=(await b.databases.retrieve({database_id:a})).properties??{},d=[],h=[];for(let[a,b]of Object.entries(e)){let e=c[a];if(!e){b.required?d.push(a):h.push(a);continue}if(e.type!==b.type)throw Error(`Notion DBプロパティ型が不正です: ${a} expected=${b.type} actual=${e.type}`)}if(d.length>0)throw Error(`必須プロパティが不足しています: ${d.join(", ")}`);return{properties:c,missingOptional:h}}function h(a,b){let c=a.properties[b];return c&&"rich_text"===c.type?(c.rich_text??[]).map(a=>a?.plain_text??"").join("").trim():""}async function i(a,b=f()){let c,d=[];do{let e=await b.databases.query({database_id:a,start_cursor:c,page_size:100});for(let a of e.results)d.push({pageId:a.id,title:function(a){let b=a.properties["タイトル"];return b&&"title"===b.type?(b.title??[]).map(a=>a?.plain_text??"").join("").trim():""}(a),doi:h(a,"DOI")||void 0,semanticScholarId:h(a,"Semantic Scholar ID")||void 0});c=e.has_more?e.next_cursor??void 0:void 0}while(c);return d}function j(a){return[{text:{content:a}}]}async function k(a,b,c=f(),d){let{properties:e}=d??await g(a,c),h=a=>!!e[a],i=(b.authors??[]).map(a=>a.name).join(", "),l=b.externalIds?.DOI??"",m=b.fieldsOfStudy??[],n={タイトル:{title:[{text:{content:b.title||"(untitled)"}}]},DOI:{rich_text:j(l)}};h("著者")&&i&&(n["著者"]={rich_text:j(i)}),h("年")&&"number"==typeof b.year&&(n["年"]={number:b.year}),h("会議/ジャーナル")&&b.venue&&(n["会議/ジャーナル"]={rich_text:j(b.venue)}),h("被引用数")&&"number"==typeof b.citationCount&&(n["被引用数"]={number:b.citationCount}),h("分野")&&m.length>0&&(n["分野"]={multi_select:m.map(a=>({name:a}))}),h("ソース")&&(n["ソース"]={select:{name:"recommendation"}}),h("Open Access PDF")&&b.openAccessPdf?.url&&(n["Open Access PDF"]={url:b.openAccessPdf.url}),h("Semantic Scholar ID")&&b.paperId&&(n["Semantic Scholar ID"]={rich_text:j(b.paperId)}),h("要約")&&b.abstract&&(n["要約"]={rich_text:j(function(a,b=2e3){let c=Array.from(a);return c.length<=b?a:`${c.slice(0,b-1).join("")}…`}(b.abstract,2e3))}),await c.pages.create({parent:{database_id:a},properties:n})}var l=c(6138);async function m(a){var b;let c=a.trim();if(!c)throw Error("identifier が空です");if(c.startsWith("DOI:"))return(await (0,l.L2)(c)).paperId;if(/^10\.[^/]+\/.+/i.test(c))return(await (0,l.L2)(`DOI:${c}`)).paperId;if(c.startsWith("title:")||(b=c).includes(" ")||b.startsWith("title:")){let a=c.startsWith("title:")?c.slice(6):c,b=await (0,l.ib)(a),d=b.data?.[0];if(!d?.paperId)throw Error(`タイトルから論文を解決できませんでした: ${a}`);return d.paperId}return c}async function n(a,b={}){let c=await m(a);return(await (0,l.IG)(c,{limit:b.limit??10,from:b.from??"recent"})).recommendedPapers??[]}async function o(a,b=[],c={}){if(0===a.length)return[];let d=await Promise.allSettled(a.map(a=>m(a))),e=await Promise.allSettled(b.map(a=>m(a))),f=d.filter(a=>"fulfilled"===a.status).map(a=>a.value),g=e.filter(a=>"fulfilled"===a.status).map(a=>a.value);return 0===f.length?[]:(await (0,l.Dz)(f,g,{limit:c.limit??20})).recommendedPapers??[]}},6138:(a,b,c)=>{"use strict";let d,e;c.d(b,{$A:()=>o,L2:()=>x,Dz:()=>w,IG:()=>v,zP:()=>p,Z2:()=>l,ib:()=>y,Q0:()=>i});class f{constructor(a,b){this.queue=[],this.processing=!1,this.maxTokens=a,this.refillIntervalMs=b,this.tokens=a,this.lastRefill=Date.now()}refill(){let a=Math.floor((Date.now()-this.lastRefill)/this.refillIntervalMs),b=a*this.maxTokens;b>0&&(this.tokens=Math.min(this.maxTokens,this.tokens+b),this.lastRefill+=a*this.refillIntervalMs)}async acquire(){return new Promise(a=>{this.queue.push(a),this.processQueue()})}async processQueue(){if(!this.processing&&0!==this.queue.length){for(this.processing=!0;this.queue.length>0;)if(this.refill(),this.tokens>0)this.tokens--,this.queue.shift()();else{let a=this.refillIntervalMs-(Date.now()-this.lastRefill);await new Promise(b=>setTimeout(b,Math.max(0,a)))}this.processing=!1}}}async function g(a,b={},c=3,d=1e3){let e;for(let f=0;f<=c;f++){let g;try{g=await fetch(a,b)}catch(a){if(e=a instanceof Error?a:Error(String(a)),f<c){let a=d*Math.pow(2,f);await new Promise(b=>setTimeout(b,a))}continue}if(g.ok)return g;if(429===g.status){if(e=Error(`HTTP ${g.status}: ${g.statusText} for ${a}`),f<c){let a=d*Math.pow(2,f);await new Promise(b=>setTimeout(b,a))}continue}if(g.status>=400&&g.status<500)throw Error(`HTTP ${g.status}: ${g.statusText} for ${a}`);if(e=Error(`HTTP ${g.status}: ${g.statusText} for ${a}`),f<c){let a=d*Math.pow(2,f);await new Promise(b=>setTimeout(b,a))}}throw e??Error(`Failed to fetch ${a}`)}let h=new f(1,1e3);async function i(a,b=30){await h.acquire();let c=new URLSearchParams({q:a,format:"json",h:String(b)}),d=`https://dblp.org/search/publ/api?${c}`,e=await g(d),f=await e.json();return(f.result?.hits?.hit??[]).map(a=>(function(a){let b=a.authors?.author,c=[];return Array.isArray(b)?c=b.map(a=>({name:a.text??String(a)})):b&&(c=[{name:b.text??String(b)}]),{title:a.title?.replace(/\.$/,"")??"",authors:c,venue:a.venue,year:a.year?parseInt(a.year,10):void 0,doi:a.doi,url:a.url,pages:a.pages}})(a.info))}let j=(0,c(8995).createRequire)("file:///Users/hirokimukai/Cloudprojects/paper-tools/packages/core/dist/crossref-client.js")("../package.json"),k=new f(10,1e3);async function l(a){await k.acquire();let b=`https://api.crossref.org/works/${encodeURIComponent(a)}`;try{let a=await g(b,{headers:function(){let a={Accept:"application/json"},b=process.env.CROSSREF_MAILTO;return b&&(a["User-Agent"]=`paper-tools/${j.version} (mailto:${b})`),a}()}),c=await a.json();return function(a){let b=(a.author??[]).map(a=>({name:a.name??[a.given,a.family].filter(Boolean).join(" "),orcid:a.ORCID,affiliations:a.affiliation?.map(a=>a.name)})),c=a.published?.["date-parts"]?.[0]??a["published-print"]?.["date-parts"]?.[0],d=c?.[0];return{title:a.title?.[0]??"",authors:b,doi:a.DOI,year:d,venue:a["container-title"]?.[0],abstract:a.abstract,keywords:a.subject,url:a.URL,pages:a.page,volume:a.volume,issue:a.issue,citationCount:a["is-referenced-by-count"],referenceCount:a["references-count"]}}(c.message)}catch(a){if(a instanceof Error&&a.message.includes("HTTP 404"))return null;throw a}}let m=new f(5,1e3);async function n(a,b){await m.acquire();let c=`https://opencitations.net/index/coci/api/v1/${a}/${encodeURIComponent(b)}`;try{let a=await g(c);return(await a.json()).map(a=>({citing:a.citing,cited:a.cited,creationDate:a.creation}))}catch(c){return console.error(`[opencitations] failed to fetch ${a} for DOI ${b}:`,c),[]}}async function o(a){return n("citations",a)}async function p(a){return n("references",a)}let q="https://api.semanticscholar.org",r="paperId,externalIds,title,abstract,year,authors,venue,referenceCount,citationCount,isOpenAccess,openAccessPdf,fieldsOfStudy";function s(){let a=!!process.env.S2_API_KEY,b=a?"key":"no-key";return d&&e===b?d:(e=b,d=a?new f(10,1e3):new f(1,3e3))}function t(){let a={Accept:"application/json","Content-Type":"application/json"},b=process.env.S2_API_KEY;return b&&(a["x-api-key"]=b),a}async function u(a){if(a.ok)return await a.json();let b=await a.text();throw Error(`Semantic Scholar API error: ${a.status} ${a.statusText} - ${b}`)}async function v(a,b={}){await s().acquire();let c=new URLSearchParams({fields:b.fields??r,limit:String(b.limit??10)});b.from&&c.set("from",b.from);let d=`${q}/recommendations/v1/papers/forpaper/${encodeURIComponent(a)}?${c}`,e=await g(d,{headers:t()});return await u(e)}async function w(a,b=[],c={}){await s().acquire();let d=new URLSearchParams({fields:c.fields??r,limit:String(c.limit??20)}),e=`${q}/recommendations/v1/papers/?${d}`,f=await g(e,{method:"POST",headers:t(),body:JSON.stringify({positivePaperIds:a,negativePaperIds:b})});return await u(f)}async function x(a,b=r){await s().acquire();let c=new URLSearchParams({fields:b}),d=`${q}/graph/v1/paper/${encodeURIComponent(a)}?${c}`,e=await g(d,{headers:t()});return await u(e)}async function y(a,b=r,c=1){await s().acquire();let d=new URLSearchParams({query:a,fields:b,limit:String(c)}),e=`${q}/graph/v1/paper/search?${d}`,f=await g(e,{headers:t()});return await u(f)}}};