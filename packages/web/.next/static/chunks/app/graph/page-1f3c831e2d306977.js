(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[813],{6139:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>s});var a=t(8111),l=t(5271);function o(e){let{graph:r,height:o=600,onNodeTap:s}=e,n=(0,l.useRef)(null),i=(0,l.useRef)(null),d=(0,l.useCallback)(async()=>{if(!n.current)return;let e=(await t.e(104).then(t.bind(t,114))).default;i.current&&i.current.destroy();let a=[...r.nodes.map(e=>{var r;return{data:{id:e.doi,label:null!=(r=e.title)?r:e.doi}}}),...r.edges.map((e,r)=>({data:{id:"e".concat(r),source:e.source,target:e.target}}))],l=e({container:n.current,elements:a,style:[{selector:"node",style:{label:"data(label)","background-color":"#6366f1",color:"#111827","font-size":"10px","text-wrap":"wrap","text-max-width":"120px",width:28,height:28}},{selector:"edge",style:{width:1.5,"line-color":"#a5b4fc","target-arrow-color":"#6366f1","target-arrow-shape":"triangle","curve-style":"bezier"}},{selector:"node:active",style:{"overlay-opacity":.2}}],layout:{name:"cose",animate:!0,animationDuration:600},minZoom:.2,maxZoom:5});l.on("tap","node",e=>{let r=e.target.id();null==s||s(r)}),i.current=l},[r,s]);return((0,l.useEffect)(()=>(d(),()=>{var e;null==(e=i.current)||e.destroy(),i.current=null}),[d]),0===r.nodes.length)?(0,a.jsx)("div",{className:"flex items-center justify-center rounded-lg border border-[var(--color-border)] text-sm text-gray-400",style:{height:o},children:"No graph data. Enter a DOI above to build a citation graph."}):(0,a.jsx)("div",{ref:n,className:"rounded-lg border border-[var(--color-border)]",style:{height:o}})}function s(){let[e,r]=(0,l.useState)(""),[t,s]=(0,l.useState)(1),[n,i]=(0,l.useState)("both"),[d,c]=(0,l.useState)(null),[u,m]=(0,l.useState)(!1),[p,h]=(0,l.useState)(null),[b,x]=(0,l.useState)(!1),g=(0,l.useCallback)(async r=>{if(r.preventDefault(),e.trim()){m(!0),h(null);try{var a;let r=new URLSearchParams({doi:e.trim(),depth:String(t),direction:n}),l=await fetch("/api/graph?".concat(r)),o=await l.json();if(!l.ok)throw Error(null!=(a=o.error)?a:"Build failed");c(o.graph)}catch(e){h(e instanceof Error?e.message:"Unknown error"),c(null)}finally{m(!1)}}},[e,t,n]),f=(0,l.useCallback)(async e=>{if(d){x(!0);try{var r;let t=await fetch("/api/graph/export",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({graph:d,format:e})}),a=await t.json();if(!t.ok)throw Error(null!=(r=a.error)?r:"Export failed");let l=new Blob([a.output],{type:"text/plain"}),o=URL.createObjectURL(l),s=document.createElement("a");s.href=o,s.download="graph.".concat("mermaid"===e?"md":"dot"===e?"gv":"json"),s.click(),URL.revokeObjectURL(o)}catch(e){h(e instanceof Error?e.message:"Unknown error")}finally{x(!1)}}},[d]);return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold",children:"Citation Graph"}),(0,a.jsxs)("form",{onSubmit:g,className:"flex flex-wrap items-end gap-3",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("label",{htmlFor:"graph-doi",className:"mb-1 block text-sm font-medium",children:"DOI"}),(0,a.jsx)("input",{id:"graph-doi",type:"text",value:e,onChange:e=>r(e.target.value),placeholder:"10.1145/3292500.3330672",disabled:u,className:"w-full rounded-lg border border-[var(--color-border)] px-3 py-2 text-sm outline-none focus:border-[var(--color-primary)] focus:ring-2 focus:ring-[var(--color-primary)]/20"})]}),(0,a.jsxs)("div",{className:"w-24",children:[(0,a.jsx)("label",{htmlFor:"graph-depth",className:"mb-1 block text-sm font-medium",children:"Depth"}),(0,a.jsx)("input",{id:"graph-depth",type:"number",min:1,max:3,value:t,onChange:e=>s(Number(e.target.value)),disabled:u,className:"w-full rounded-lg border border-[var(--color-border)] px-3 py-2 text-sm outline-none focus:border-[var(--color-primary)]"})]}),(0,a.jsxs)("div",{className:"w-32",children:[(0,a.jsx)("label",{htmlFor:"graph-dir",className:"mb-1 block text-sm font-medium",children:"Direction"}),(0,a.jsxs)("select",{id:"graph-dir",value:n,onChange:e=>i(e.target.value),disabled:u,className:"w-full rounded-lg border border-[var(--color-border)] px-3 py-2 text-sm outline-none focus:border-[var(--color-primary)]",children:[(0,a.jsx)("option",{value:"both",children:"Both"}),(0,a.jsx)("option",{value:"citing",children:"Citing"}),(0,a.jsx)("option",{value:"cited",children:"Cited"})]})]}),(0,a.jsx)("button",{type:"submit",disabled:u||!e.trim(),className:"rounded-lg bg-[var(--color-primary)] px-5 py-2 text-sm font-medium text-white transition-colors hover:bg-[var(--color-primary-hover)] disabled:cursor-not-allowed disabled:opacity-50",children:u?"Buildingâ€¦":"Build Graph"})]}),p&&(0,a.jsx)("div",{className:"rounded-lg bg-red-50 p-3 text-sm text-red-700",children:p}),d&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("span",{className:"text-sm text-gray-500",children:[d.nodes.length," nodes \xb7 ",d.edges.length," edges"]}),(0,a.jsx)("div",{className:"ml-auto flex gap-2",children:["json","dot","mermaid"].map(e=>(0,a.jsxs)("button",{onClick:()=>f(e),disabled:b,className:"rounded border border-[var(--color-border)] px-3 py-1 text-xs font-medium transition-colors hover:bg-gray-50 disabled:opacity-50",children:["Export ",e.toUpperCase()]},e))})]}),(0,a.jsx)(o,{graph:d})]})]})}},6842:(e,r,t)=>{Promise.resolve().then(t.bind(t,6139))}},e=>{e.O(0,[814,743,358],()=>e(e.s=6842)),_N_E=e.O()}]);